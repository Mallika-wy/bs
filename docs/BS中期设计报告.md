













# 商品比价网站 设计文档

# 3220102185 王阳














[TOC]

















## 一、任务要求

1. 注册、登录
   - 用户名、密码要求在 6 字节以上
   - email 的格式验证
   - 保证用户名和 email 在系统中唯一
2. 通过商品名称在主流电商平台上查询该商品实时价格
   - 商品名称进行分词处理优化查询
   - 查询多个结果的处理
   - 需要实现购物平台自动登录查询
   - 支持至少 2 个以上平台查询价格进行比较（淘宝、京东等）。 本项目选取淘宝和京东两个购物平台
3. 商品库
   - 将商品信息和商品价格保存在数据库中
   - 商品信息包含名称、多级品类、 规格、条码、图片等
4.  商品查询界面
   - 显示商品信息
   - 把历史价格用图表形式显示（如价格走势图）。
5. 设置降价提醒，针对指定商品定时查询最新价格，如有降价发送提醒，通过邮件方式实现。 
6. 样式适配手机，能够在手机浏览器/微信等应用内置的浏览器中友好显示

## 二、技术路线

前端：Vite、Vue3

后端：Python Flask后端框架

爬虫：DrissionPage (Python库)

数据库：MySQL8

## 三、接口文档

根路由：

### 3.1 注册

1. 接口信息

   - **接口路径**：`/register`

   - **请求方法**：`POST`

   - **接口描述**：用户注册接口，用于创建新用户

2. 请求体格式
   - JSON 格式发送请求体
   
   - 包含以下字段
   
     | 字段名   | 类型    | 必填 | 描述     |
     | :------- | :------ | :--- | :------- |
     | name     | string  | 是   | 用户名   |
     | password | string  | 是   | 密码     |
     | email    | string  | 是   | 邮箱地址 |
     | sex      | integer | 是   | 性别     |
     | address  | string  | 是   | 地址     |
     | phone    | string  | 是   | 电话号码 |
     |          |         |      |          |

3. 响应返回

   - 成功响应

     ```json
     {
         'code': 200,
         'message': 'User created successfully',
         'data': {
             'id': new_user.id,
             'name': new_user.name,
             'email': new_user.email,
             'phone': new_user.phone,
             'address': new_user.address
         }
     }
     ```

   - 失败响应：用户名重复

     ```json
     {
         'code': 409,
         'message': 'User created successfully'
     }
     ```

   - 失败响应：邮箱重复

     ```json
     {
         'code': 409,
         'message': 'Email created successfully'
     }
     ```

### 3.2 登录

1. **接口信息**

   - **接口路径**：`/login`
   - **请求方法**：`POST`
   - **接口描述**：用户登录接口，用于验证用户身份并返回登录信息。

2. **请求体格式**

   - JSON 格式发送请求体。

   - 包含以下字段

     | 字段名   | 类型   | 必填 | 描述   |
     | :------- | :----- | :--- | :----- |
     | name     | string | 是   | 用户名 |
     | password | string | 是   | 密码   |
     |          |        |      |        |

3. **响应返回**

   - **成功响应**

     ```json
     {
         "code": 200,
         "message": "Login successful",
         "data": {
             "id": user.id,
             "name": user.name,
             "email": user.email,
             "phone": user.phone,
             "address": user.address,
             "sex": user.sex,
             "cookie": a string
         }
     }
     ```

   - **失败响应：密码错误**

     ```json
     {
         "code": 401,
         "message": "password error"
     }
     ```

   - **失败响应：无效凭证**

     ```json
     {
         "code": 401,
         "message": "Invalid credentials"
     }
     ```

### 3.3 修改用户信息

1. **接口信息**

   - **接口路径**：`/modifyUser`
   - **请求方法**：`POST`
   - **接口描述**：允许已认证用户修改其个人信息，包括用户名、邮箱、电话、地址和性别。

2. **请求体格式**

   - JSON 格式发送请求体。

   - 包含以下字段

     | 字段名       | 类型    | 必填 | 描述                 |
     | :----------- | :------ | :--- | :------------------- |
     | id           | integer | 是   | 用户ID               |
     | modifiedUser | object  | 是   | 包含修改后的用户信息 |

     

     **modifiedUser** 对象包含：

        | 字段名  | 类型   | 必填 | 描述       |
     | :------ | :----- | :--- | :--------- |
     | name    | string | 否   | 新用户名   |
     | email   | string | 否   | 新邮箱地址 |
     | phone   | string | 否   | 新电话号码 |
     | address | string | 否   | 新地址     |
     | sex     | string | 否   | 新性别     |

     **示例请求体**：

     ```json
     {
       "id": 1,
       "modifiedUser": {
         "name": "new_username",
         "email": "new_email@example.com",
         "phone": "1234567890",
         "address": "123 New Street",
         "sex": 1
       }
     }
     ```

3. **响应返回**

   - **成功响应**

     ```json
      {
       "code": 200,
       "message": "User modified successfully",
       "data": {
         "id": 1,
         "name": "new_username",
         "email": "new_email@example.com",
         "phone": "1234567890",
         "address": "123 New Street",
         "sex": 1
       }
     }
     ```
     
   - **失败响应：用户名已存在**

     ```json
      {
       "code": 409,
      "message": "This name is already taken"
     }
     ```
     
   - **失败响应：邮箱已存在**
   
     ```json
      {
       "code": 409,
      "message": "This email is already taken"
     } 

### 3.4 添加淘宝账号

1. **接口信息**

   - **接口路径**：`/addTb`
   - **请求方法**：`POST`
   - **接口描述**：允许用户添加他们的淘宝账号信息，包括用户名和密码，后端通过账密进行淘宝网自动登录，自动获取cookie并保存

2. **请求体格式**

   - JSON 格式发送请求体。

   - 包含以下字段

     | 字段名  | 类型    | 必填 | 描述         |
     | :------ | :------ | :--- | :----------- |
     | user_id | integer | 是   | 用户ID       |
     | info_tb | object  | 是   | 淘宝账号信息 |

     **info_tb** 对象包含：

     | 字段名     | 类型   | 必填 | 描述       |
     | :--------- | :----- | :--- | :--------- |
     | t_name     | string | 是   | 淘宝用户名 |
     | t_password | string | 是   | 淘宝密码   |

     **示例请求体**：

     ```json
     {
       "user_id": 1,
       "info_tb": {
         "t_name": "taobao_username",
         "t_password": "taobao_password"
       }
     }

3. **响应返回**

   - **成功响应**

     ```json
     {
       "code": 200,
       "message": "添加淘宝账号成功"
     }
     ```

   - **失败响应：账号密码错误**

     ```json
     {
       "code": 401,
       "message": "淘宝账号添加失败，可能账号密码错误"
     }
     ```

### 3.5 添加京东账号

1. **接口信息**

   - **接口路径**：`/addJd`
   - **请求方法**：`POST`
   - **接口描述**：允许用户添加他们的京东账号信息，通过扫码登录并获取相关的Cookies。需要配合`get_qrcode`实现登录京东功能。

2. **请求体格式**

   - JSON 格式发送请求体。

   - 包含以下字段

     | 字段名  | 类型    | 必填 | 描述   |
     | :------ | :------ | :--- | :----- |
     | user_id | integer | 是   | 用户ID |

     **示例请求体**：

     ```json
     {
       "user_id": 1
     }
     ```

3. **响应返回**

   - **成功响应**

     ```json
     {
       "code": 200,
       "message": "添加京东账号成功"
     }
     ```

   - **失败响应：超时**

     ```json
     {
       "code": 401,
       "message": "超时，请重新尝试扫码登录"
     }
     ```

### 3.6 获取二维码

1. **接口信息**

   - **接口路径**：`/getQrcode`
   - **请求方法**：`GET`
   - **接口描述**：用于获取京东账号扫码登录的二维码。接口会等待直到二维码生成或超时。

2. **请求参数**

   - 无需请求参数。

3. **响应返回**

   - **成功响应**

     ```json
     {
       "code": 200,
       "message": "成功得到二维码",
       "data": "二维码Base64字符串"
     }
     ```

   - **失败响应：未获得二维码**

     ```json
     {
       "code": 401,
       "message": "没有获得到二维码"
     }
     ```

### 3.7 搜索商品

1. **接口信息**

   - **接口路径**：`/search`
   - **请求方法**：`GET`
   - **接口描述**：根据用户ID和搜索文本，搜索商品信息。如果搜索库中有匹配的记录，则从库中获取商品信息；否则，使用用户的淘宝和京东账号爬取商品数据。

2. **请求参数**

   - **用户ID** (`id`): 用户的唯一标识符。
   - **搜索文本** (`searchText`): 用户输入的搜索关键词。

3. **响应返回**

   - **成功响应：从搜索库中查询**

     ```json
     {
       "code": 200,
       "message": "成功搜索到商品,从搜索库中查询",
       "data": [
         {
           "item_id": 1,
           "real_id": "123456",
           "title": "商品标题",
           "type": "商品类型",
           "price": 99.99,
           "nick": "卖家昵称",
           "item_url": "商品链接",
           "img_url": "商品图片链接",
           "procity": "商品省份"
         },
         ...
       ]
     }
     ```

   - **成功响应：爬取淘宝和京东商品数据**

     ```json
     {
       "code": 200,
       "message": "搜索成功",
       "data": [
         {
           "item_id": 1,
           "real_id": "123456",
           "title": "商品标题",
           "type": "商品类型",
           "price": 99.99,
           "nick": "卖家昵称",
           "item_url": "商品链接",
           "img_url": "商品图片链接",
           "procity": "商品省份"
         },
         ...
       ]
     }
     ```

   - **失败响应：未设置淘宝账号**

     ```json
     {
       "code": 401,
       "message": "您没有设置淘宝的账号，无法爬取淘宝商品数据"
     }
     ```

   - **失败响应：未设置京东账号**

     ```json
     {
       "code": 401,
       "message": "您没有设置京东的账号，无法爬取京东商品数据"
     }
     ```

### 3.8 获取说明文档内容

1. **接口信息**

   - **接口路径**：`/getDoc`
   - **请求方法**：`GET`
   - **接口描述**：获取项目相关的文档内容，通常是`doc.md`文件中的内容。

2. **请求参数**

   - 无需请求参数。

3. **响应返回**

   - **成功响应**

     ```json
     {
       "code": 200,
       "message": "获取数据成功",
       "data": "这里是doc.md文件的Markdown内容"
     }
     ```

### 3.9 获取用户搜索历史记录

1. **接口信息**

   - **接口路径**：`/history`
   - **请求方法**：`GET`
   - **接口描述**：获取指定用户的搜索历史记录，包括搜索内容、相关商品ID列表以及商品数量。

2. **请求参数**

   - **用户ID** (`user_id`): 用户的唯一标识符，作为查询参数。

3. **响应返回**

   - **成功响应**

     json

     ```json
     {
       "code": 200,
       "message": "查找记录成功",
       "data": [
         {
           "search_id": 1,
           "search_text": "搜索关键词",
           "item_ids": [1, 2, 3],
           "num_items": 3
         },
         ...
       ]
     }
     ```

3.10 订阅商品

1. **接口信息**

   - **接口路径**：`/subscribe`
   - **请求方法**：`POST`
   - **接口描述**：允许用户订阅特定的商品，以便在商品价格变动时收到通知。

2. **请求体格式**

   - JSON 格式发送请求体。

   - 包含以下字段

     | 字段名  | 类型    | 必填 | 描述   |
     | :------ | :------ | :--- | :----- |
     | user_id | integer | 是   | 用户ID |
     | item_id | integer | 是   | 商品ID |

     **示例请求体**：

       ```json
       {
         "user_id": 1,
         "item_id": 101
       }
       ```

3. **响应返回**

   - **成功响应**

     ```json
      {
       "code": 200,
       "message": "订阅成功"
     }
     ```
     
   - **失败响应：用户不存在**

     ```json
      {
       "code": 409,
      "message": "该用户不存在"
     }
     ```
     
   - **失败响应：商品不存在**
   
     ```json
      {
       "code": 409,
      "message": "该商品不存在"
     }
  ```

### 3.11  检查订阅商品价格变动

1. **接口信息**

   - **接口路径**：`/checkSubscribe`
   - **请求方法**：`POST`
   - **接口描述**：检查用户订阅的商品价格是否有变动，如果有降价，通过邮件通知用户。

2. **请求体格式**

   - JSON 格式发送请求体。

   - 包含以下字段

     | 字段名  | 类型    | 必填 | 描述   |
     | :------ | :------ | :--- | :----- |
     | user_id | integer | 是   | 用户ID |

     **示例请求体**：

     ```json
     {
         "user_id": 1
     }
  ```

​     

3. **响应返回**

   - **成功响应：没有检测到商品降价**

     ```json
     {
       "code": 200,
       "message": "没有检测到商品降价"
     }
     ```

   - **成功响应：检测到商品降价，邮件已发送**

     ```json
     {
       "code": 200,
       "message": "检测到商品降价, 具体信息已发送给您的邮箱"
     }
     ```

   - **失败响应：未设置淘宝账号**

     ```json
     {
       "code": 401,
       "message": "您没有设置淘宝的账号，无法爬取淘宝商品数据"
     }
     ```

   - **失败响应：未设置京东账号**

     ```json
     {
       "code": 401,
       "message": "您没有设置京东的账号，无法爬取京东商品数据"
     }
     ```

### 3.12 搜索商品详细信息

1. **接口信息**

   - **接口路径**：`/searchItem`
   - **请求方法**：`GET`
   - **接口描述**：根据用户ID和商品ID，获取商品的详细信息，包括价格历史和价格走势图。

2. **请求参数**

   - **用户ID** (`user_id`): 用户的唯一标识符，作为查询参数。
   - **商品ID** (`item_id`): 商品的唯一标识符，作为查询参数。

3. **响应返回**

   - **成功响应**

     ```json
     {
       "code": 200,
       "message": "详情获取成功",
       "data": {
         "id": 1,
         "real_id": "商品真实ID",
         "title": "商品标题",
         "price": 99.99,
         "nick": "卖家昵称",
         "item_url": "商品链接",
         "img_url": "商品图片链接",
         "procity": "商品省份",
         "specification": "商品规格",
         "history_image": "价格走势图的Base64字符串"
       }
     }
     ```

   - **失败响应：商品不存在**

     ```json
     {
       "code": 401,
       "message": "没有找到该商品"
     }
     ```

   - **失败响应：未设置淘宝账号**

     ```json
     {
       "code": 401,
       "message": "您没有设置淘宝的账号，无法爬取淘宝商品数据"
     }
     ```

## 四、开发规划（To Do）

目前实现：

1. 登录注册功能前后端
2. 京东淘宝爬虫
3. 搜索功能前后端
4. 用户界面前后端
5. 降价订阅前后端
6. 商品展示前后端

还需实现：

1. 修改前端，适合手机端样式
2. 完善说明文档等各类文档
3. 历史价格显示
4. docker打包
